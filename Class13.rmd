---
title: "Class13"
author: "Maris Sala"
date: "4/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
This is the IGT task with actual data instead of simulated one. Posterior predictive checks of descriptive adequacy

Setup
```{r}
set.seed(1982)
#setwd("~/Aarhus University/Advanced cog mod/progre")
pacman::p_load(extraDistr, R2jags)

# load control data
ctr_data <- read.table("rawData/IGTdata_healthy_control.txt", header=T)
```

Prepare the data for the JAGS model
Turning it into a matrix
```{r}
# Identify and count unique subject IDs
subIDs <- unique(ctr_data$subjID)
nsubs <- length(subIDs)
ntrials_max <- 100

# All choices (x) and outcomes (X)
x_raw <- ctr_data$deck
X_raw <- ctr_data$gain + ctr_data$loss
```

Assign choices and outcomes in trial x sub matrix
Different number of trials across subjects. We'll need to fix this by padding arrays of < 100. Then we'll also need to record number of valid trials for each sub, then run the JAGS model on only valid trials!
```{r}
# Empty arrays to fill
ntrials_all <- array(0, c(nsubs))
x_all <- array(0, c(nsubs, ntrials_max))
X_all <- array(0, c(nsubs, ntrials_max))

# Fill the arrays! Loop over subjects
for (s in 1:nsubs) {
  #record n trials for subject s. Count number of trials for subject
  ntrials_all[s] <- length(x_raw[ctr_data$subjID==subIDs[s]])
  
  #pad trials with NA if n trials < maximum (i e 100)
  x_sub <- x_raw[ctr_data$subjID==subIDs[s]]
  length(x_sub) <- ntrials_max
  
  X_sub <- X_raw[ctr_data$subjID==subIDs[s]]
  length(X_sub) <- ntrials_max
  #^temporary data for subject s, padded with NA where there are no trials, the NA's do NOT get into JAGS!
  
  #assign arrays
  x_all[s,] <- x_sub
  X_all[s,] <- X_sub
}
```

Applying the model to data
```{r}
x <- x_all[1,]
X <- X_all[1,]

ntrials <- ntrials_all[1]

# Set up jags and run jags model on one subject
data <- list("x", "X", "ntrials")
params <- c("w", "A", "theta", "a", "p")
samples <- jags.parallel(data, inits = NULL, params,
                model.file = "jags_models/PVL.txt",
                n.chains = 3, n.iter = 5000, n.burnin = 1000, n.thin = 1)

summary(samples)
```

